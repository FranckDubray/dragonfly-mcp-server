{
  "type": "function",
  "function": {
    "name": "legifrance_consult",
    "displayName": "Légifrance Consult",
    "category": "documents",
    "tags": ["external_sources", "knowledge", "legal", "france"],
    "description": "Consultation du corpus juridique français (LEGI).\n\n[DEUX STRATEGIES PRINCIPALES]\n\n[STRATEGIE A] NAVIGATION PURE (Recommandée pour exploration structurée et fiabilité maximale)\n1. Lister les codes disponibles ou partir d'un code connu (code_id)\n2. Explorer l'arborescence avec get_section_tree (profondeur progressive : 2→4→6)\n3. Identifier les article_ids pertinents dans l'arbre\n4. Récupérer les textes avec get_articles en BATCH (max 50 IDs par appel)\n\n[STRATEGIE B] RECHERCHE PUIS NAVIGATION (Si vous connaissez des mots-clés EXACTS)\n1. Tenter search_sections avec 1 mot-clé ou 1 expression EXACTE\n2. Si résultats : naviguer dans les section_id trouvées avec get_section_tree\n3. Si 0 résultats après 2 tentatives : basculer sur STRATEGIE A\n\n[POINTS CRITIQUES]\n- search_sections est TRÈS restrictif : sensible aux accents, expressions doivent être COMPLÈTES et EXACTES\n- get_section_tree sur racine complète d'un code = erreur (trop volumineux) → toujours cibler une sous-section ou démarrer avec profondeur 2\n- Toujours batcher les get_articles (50 IDs max par appel) plutôt qu'appeler 1 par 1\n\n[NAVIGATION RECOMMANDÉE]\n- Partir de la racine d'un code avec max_depth=2 pour découvrir les LIVRES/TITRES principaux\n- Identifier le LIVRE pertinent (ex: LIVRE II pour sociétés commerciales dans Code de commerce)\n- Explorer ce LIVRE avec max_depth=4, puis 6 si nécessaire pour atteindre les articles\n- Les code_id des codes français suivent le format LEGITEXT000... (découverts par navigation)",

    "parameters": {
      "type": "object",
      "properties": {
        "operation": {
          "type": "string",
          "enum": ["search_sections", "get_section_tree", "get_articles"],
          "description": "Type d'opération à effectuer.\n\n- search_sections : Recherche textuelle de sections (très restrictive, voir règles ci-dessous)\n- get_section_tree : Navigation dans l'arborescence d'un code/section (stratégie principale)\n- get_articles : Récupération du texte complet des articles (batch recommandé)"
        },
        
        "query": {
          "type": "string",
          "minLength": 3,
          "maxLength": 50,
          "description": "[search_sections] Requête textuelle STRICTE (respecter EXACTEMENT l'orthographe des titres de sections).\n\n[REGLES CRITIQUES] (validées empiriquement)\n- Expressions COMPLÈTES uniquement : 'société anonyme', 'conseil d'administration', 'contrat de travail'\n- JAMAIS d'expressions tronquées : 'conseil administration', 'contrat travail' → 0 résultats\n- ACCENTS OBLIGATOIRES : 'société', 'gérant', 'président' (sans accent = échec total)\n- Mots uniques les plus sûrs : 'administrateur', 'licenciement', 'mandat', 'gérant', 'président'\n- Acronymes ne fonctionnent PAS : 'SARL', 'SA' → toujours 0 résultats\n\n[EXEMPLES QUI FONCTIONNENT]\n- Mots uniques : 'administrateur', 'gérant', 'licenciement', 'président', 'mandat'\n- Expressions complètes : 'société anonyme', 'conseil d'administration', 'contrat de travail'\n\n[EXEMPLES QUI ECHOUENT]\n- Sans accent : 'societe anonyme', 'gerant', 'president'\n- Incomplets : 'conseil administration', 'contrat travail'\n- Acronymes : 'SARL', 'SA'\n\n[STRATEGIE RECOMMANDEE]\n1. Privilégier UN MOT UNIQUE si possible (ex: 'gérant', 'licenciement')\n2. Si expression nécessaire : vérifier qu'elle est EXACTE (accents, apostrophes, mots de liaison)\n3. Si 0 résultats après 2 tentatives : passer à la navigation pure (get_section_tree)"
        },

        "code_id": {
          "type": "string",
          "pattern": "^LEGITEXT[0-9]{12}$",
          "description": "[search_sections, get_section_tree] ID du code juridique (format: LEGITEXT suivi de 12 chiffres).\n\n[CODES MAJEURS] (découverts par navigation, non exhaustif)\n- Code de commerce : commence par LEGITEXT000005...\n- Code du travail : commence par LEGITEXT000006...\n- Code civil : commence par LEGITEXT000006...\n\nSi vous ne connaissez pas le code_id : utilisez get_section_tree sans code_id ni section_id (racine) avec max_depth=2 pour lister tous les codes disponibles."
        },

        "section_id": {
          "type": "string",
          "pattern": "^LEGISCTA[0-9]{12}$",
          "description": "[get_section_tree] ID de la section à explorer (format: LEGISCTA suivi de 12 chiffres).\n\n[COMMENT OBTENIR UN section_id]\n- Via search_sections (si succès)\n- Via navigation progressive : get_section_tree sur code entier (profondeur 2) → identifier section pertinente → explorer cette section\n\nOptionnel : si omis, explore depuis la racine du code_id (attention à la taille avec profondeur élevée)"
        },

        "article_ids": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^LEGIARTI[0-9]{12}$"
          },
          "minItems": 1,
          "maxItems": 50,
          "description": "[get_articles] Liste des IDs d'articles à récupérer (format: LEGIARTI suivi de 12 chiffres).\n\n[BATCH OBLIGATOIRE] Récupérez TOUS les articles pertinents en UN SEUL appel (max 50)\nN'appelez JAMAIS get_articles article par article (inefficace)\n\n[COMMENT OBTENIR LES article_ids]\n- Via get_section_tree (avec include_articles=true) : parcourir l'arbre et collecter tous les IDs d'articles pertinents\n- Puis faire UN SEUL appel get_articles avec la liste complète"
        },

        "etat": {
          "type": "string",
          "enum": ["VIGUEUR", "ABROGE", "ALL"],
          "default": "VIGUEUR",
          "description": "Filtre sur l'état des articles/sections.\n\n- VIGUEUR (défaut) : Uniquement textes en vigueur actuellement\n- ABROGE : Uniquement textes abrogés (historique)\n- ALL : Tous les textes (vigueur + abrogés)\n\nUtilisez VIGUEUR sauf besoin d'analyse historique spécifique"
        },

        "max_depth": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 4,
          "description": "[get_section_tree] Profondeur d'exploration de l'arbre (default=4 recommandé).\n\n[GUIDE DE PROFONDEUR] (validé par l'usage)\n- Profondeur 2 : Découverte de la structure générale (LIVRES, TITRES) — rapide, vue d'ensemble\n- Profondeur 4 : Exploration standard (CHAPITRES, SECTIONS, ARTICLES) — OPTIMAL pour la plupart des cas\n- Profondeur 6+ : Exploration exhaustive (tous niveaux imbriqués) — peut être lent, gros volumes\n\n[APPROCHE PROGRESSIVE RECOMMANDEE]\n1. Démarrer avec max_depth=2 pour repérer la structure\n2. Identifier la section pertinente\n3. Re-explorer cette section avec max_depth=4 (ou 6 si nécessaire)\n4. Éviter profondeur 10 d'emblée sur sections larges (risque de timeout/dépassement)"
        },

        "include_articles": {
          "type": "boolean",
          "default": true,
          "description": "[get_section_tree] Inclure les IDs des articles dans l'arbre.\n\n- true (recommandé) : Récupère les article_ids pour ensuite faire get_articles en batch\n- false : Uniquement la structure (sections/sous-sections), sans articles"
        },

        "max_size_kb": {
          "type": "integer",
          "minimum": 50,
          "maximum": 5000,
          "description": "[get_section_tree] Taille maximale du retour en kilo-octets (limite de sécurité).\n\nSi dépassée : erreur renvoyée avec suggestion de cibler une sous-section plus précise ou réduire max_depth.\n\nValeur par défaut système : ~5000 KB\n- Suffit pour la plupart des explorations avec max_depth=4\n- Si erreur : réduire max_depth ou cibler un section_id plus spécifique"
        },

        "include_breadcrumb": {
          "type": "boolean",
          "default": true,
          "description": "[get_articles, get_section_tree] Inclure le fil d'Ariane (breadcrumb) pour situer les articles/sections dans la hiérarchie.\n\n- true (recommandé) : Donne le contexte complet (Partie > Livre > Titre > Chapitre > Section > Article)\n- false : Uniquement données brutes sans contexte hiérarchique"
        },

        "include_links": {
          "type": "boolean",
          "default": true,
          "description": "[get_articles] Inclure les liens juridiques (références vers d'autres articles, décrets, etc.).\n\n- true (défaut) : Enrichit le contexte avec les renvois légaux\n- false : Uniquement le texte de l'article sans liens"
        },

        "date": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "[get_articles] Date de version historique au format YYYY-MM-DD (optionnel).\n\nUsage : Récupérer le texte d'un article tel qu'il était en vigueur à une date passée.\n- Omis (défaut) : version actuelle en vigueur\n- Spécifié : version en vigueur à cette date historique\n\nLa date doit être dans la période de validité de l'article"
        },

        "limit": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 20,
          "description": "[search_sections] Nombre maximum de résultats à retourner.\n\n20 par défaut suffit généralement (les résultats les plus pertinents apparaissent en premier)"
        }
      },
      "required": ["operation"],
      "additionalProperties": false
    }
  }
}
