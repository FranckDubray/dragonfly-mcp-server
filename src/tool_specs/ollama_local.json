{
  "type": "function",
  "function": {
    "name": "ollama_local",
    "displayName": "Ollama Local + Web Search",
    "category": "intelligence",
    "description": "Interface avec Ollama local (localhost:11434) + recherche web cloud. Gestion modèles, génération, chat, embeddings, recherche web. IMPORTANT: Pour analyser des images, utiliser operation='generate' (pas 'chat').",
    "parameters": {
      "type": "object",
      "properties": {
        "operation": {
          "type": "string",
          "enum": [
            "list_models", "get_version", "get_running_models", "show_model",
            "pull_model", "push_model", "create_model", "copy_model", "delete_model",
            "generate", "chat", "embeddings", "web_search", "chat_with_web"
          ],
          "description": "Opération à effectuer. Pour images: utiliser 'generate' (REQUIS pour vision). Pour chat sans images: utiliser 'chat'."
        },
        "model": {
          "type": "string", 
          "description": "Nom du modèle (requis pour generate, chat, embeddings, show_model, pull_model, etc.). Pour vision: llava:13b, llava:7b, bakllava"
        },
        "prompt": {
          "type": "string",
          "description": "Prompt de génération (requis pour generate). Pour analyse d'images, décrire ce que vous voulez savoir sur l'image."
        },
        "messages": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "role": {"type": "string", "enum": ["system", "user", "assistant"]},
              "content": {"type": "string"}
            },
            "required": ["role", "content"]
          },
          "description": "Messages pour chat (requis pour chat, chat_with_web). NOTE: 'chat' ne supporte PAS les images, utiliser 'generate' à la place."
        },
        "text": {
          "type": "string", 
          "description": "Texte pour embeddings (requis pour embeddings)"
        },
        "query": {
          "type": "string",
          "description": "Requête de recherche web (requis pour web_search, chat_with_web)"
        },
        "image_urls": {
          "type": "array",
          "items": {"type": "string"},
          "description": "URLs d'images HTTP(S) pour modèles vision (generate uniquement). Note: téléchargement pas encore implémenté, utiliser image_files"
        },
        "image_files": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Chemins images pour modèles vision (generate uniquement). Relatifs racine projet ou docs/. Formats: JPEG, PNG. Résolution: 336-672px recommandée. Ratios: carré 1:1 ou allongés jusqu'à 1:4 / 4:1. Taille max: 5 MB. Max: 4 images. Ex: 'docs/gemini_image_68dfaca1489e1.png'"
        },
        "stream": {
          "type": "boolean",
          "description": "Streaming pour generate/chat (défaut: false)",
          "default": false
        },
        "temperature": {
          "type": "number",
          "description": "Créativité 0.0-2.0 (défaut: 0.7)",
          "minimum": 0.0,
          "maximum": 2.0,
          "default": 0.7
        },
        "max_tokens": {
          "type": "integer", 
          "description": "Limite tokens (défaut: 4000)",
          "minimum": 1,
          "maximum": 50000,
          "default": 4000
        },
        "timeout": {
          "type": "integer",
          "description": "Timeout secondes (défaut: 120)",
          "minimum": 10,
          "maximum": 600,
          "default": 120
        },
        "web_search_max_results": {
          "type": "integer",
          "description": "Max résultats web search (défaut: 5)",
          "minimum": 1, 
          "maximum": 20,
          "default": 5
        },
        "source_model": {
          "type": "string",
          "description": "Modèle source pour copy_model"
        },
        "destination_model": {
          "type": "string", 
          "description": "Modèle destination pour copy_model"
        },
        "modelfile": {
          "type": "string",
          "description": "Contenu Modelfile pour create_model"
        },
        "options": {
          "type": "object",
          "description": "Options avancées modèle (top_k, top_p, etc.)"
        }
      },
      "required": ["operation"],
      "additionalProperties": false
    }
  }
}
