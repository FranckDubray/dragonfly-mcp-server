{
  "type": "function",
  "function": {
    "name": "call_llm",
    "displayName": "LLM Orchestrator",
    "category": "intelligence",
    "description": "Appelle un modèle LLM en streaming. Orchestration tool_calls (MCP) en 2 phases. Supporte l’entrée multi-modale (images) via messages OpenAI, image_urls ou des fichiers du répertoire docs/.",
    "parameters": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string",
          "description": "Message utilisateur (recommandé même en mode vision)."
        },
        "messages": {
          "type": "array",
          "description": "Messages bruts au format OpenAI. Si fourni, il est utilisé tel quel (les champs image_urls et image_files sont ignorés).",
          "items": {
            "type": "object",
            "properties": {
              "role": { "type": "string", "enum": ["system","user","assistant","tool"] },
              "content": {
                "description": "String ou tableau de segments OpenAI ({type:'text',text:'...'} | {type:'image_url',image_url:'...'|{url:'...',detail?:'low'|'high'|'auto'}}).",
                "oneOf": [
                  { "type": "string" },
                  { "type": "array", "items": { "type": "object" } }
                ]
              }
            },
            "required": ["role","content"],
            "additionalProperties": true
          }
        },
        "image_urls": {
          "type": "array",
          "description": "URLs d’images à inclure avec le message (raccourci).",
          "items": { "type": "string", "minLength": 1 }
        },
        "image_files": {
          "type": "array",
          "description": "Chemins d’images stockées dans docs/images ou docs/video/frames (ex: 'docs/images/plan.png'). Seront encodées en data URL.",
          "items": { "type": "string", "minLength": 1 }
        },
        "promptSystem": { "type": "string", "description": "Contexte système séparé (pas dans messages)." },
        "model": { "type": "string", "description": "Nom du modèle (ex: gpt-4o/gpt-5-vision)." },
        "assistantId": { "type": "string", "description": "Identifiant d'assistant (portail) si vous souhaitez cibler un assistant préconfiguré." },
        "temperature": { "type": "number", "description": "Température d'échantillonnage (défaut: 1)." },
        "max_tokens": { "type": "integer", "description": "Max tokens de la réponse finale." },
        "tool_names": {
          "type": "array",
          "description": "Outils MCP autorisés pour le 1er appel.",
          "items": { "type": "string" }
        },
        "debug": { "type": "boolean", "description": "Inclut un debug détaillé." }
      },
      "required": ["message","model"],
      "additionalProperties": false
    }
  }
}
