












# 🔍 MÉTHODOLOGIE AUDIT TOOLS

## État: 23/40 audités ✅

Tools restants (17): astronomy, coingecko, excel_to_sqlite, ffmpeg_frames, flight_tracker, git, imap, math, news_aggregator, ollama_local, pdf2text, pdf_download, reddit_intelligence, script_executor, ssh_admin, universal_doc_scraper, youtube_search

✅ Derniers audits:
- open_meteo (22/40) — 8.8→9.6/10 — validation + NR 100% OK — split core_weather/core_geo, truncation counts
- office_to_pdf (23/40) — 8.9→9.5/10 — validation + NR 100% OK — lazy import + service office_converter

---

## WORKSPACE (règles fermes)
- LLM_DEV_GUIDE.md et ce fichier DOIVENT rester chargés.
- UN SEUL tool à la fois.
- 🎲 Sélection du prochain tool: si plusieurs tools restants, utiliser le MCP tool « random » (operation: pick_random) avec la liste « Tools restants ». Si un seul tool reste, le sélectionner directement (sans tirage).
- 🔄 RELOAD OBLIGATOIRE: après toute création/modification d’un tool, le LLM DOIT appeler GET /tools?reload=1 (réponse compacte par défaut: {reloaded, tool_count, errors}). N’utiliser list=1 qu’en cas de besoin explicite de la liste complète.
- Unload du tool à la fin seulement.

---

## PROCESS (10 étapes) + Mermaid (ASCII safe)

```mermaid
flowchart TD
  A[Start] --> B[Select_tool (random if many)]
  B --> C[Load_tool_files]
  C --> C2[Tools_reload]
  C2 --> D[Pre_tests_3]
  D --> E[Abort_document]
  D --> F[Audit_spec_code]
  F --> G{Nonconformities}
  G --> H[Fixes]
  G --> I[Validation_tests]
  H --> I
  I --> J{Validation_OK}
  J --> H
  J --> K[NR_tests_5]
  K --> L{NR_100_OK}
  L --> H
  L --> M[Changelog_update]
  M --> N{Gate_commit_push}
  N --> O[Commit_push]
  N --> P[Commit_local_only]
  O --> Q[Unload_update_procedure]
  P --> Q
  E --> Q
```

Notes:
- Étape B: choisir le prochain tool par tirage via « random » (pick_random) quand il en reste plusieurs; sinon sélectionner l’unique restant.
- Étape C2 obligatoire: GET /tools?reload=1 juste avant les tests (compact, sans liste par défaut). Si besoin de la liste, utiliser /tools?reload=1&list=1.

---

## Rappels critiques
1) Un seul tool à la fois; RELOAD OBLIGATOIRE via GET /tools?reload=1 après dev/modif et avant tests
2) Tests réels via MCP; ABORT si impossibles
3) Validation stricte; outputs minimaux; limits + truncation si listes
4) Commit+Push seulement si NR=100% OK
5) Changelog: dernière entrée en premier dans Unreleased (puis déplacer en release lors de la coupe)
6) Unload seulement le tool; garder les docs chargés

---

## Mises à jour (v2 – 2025-10-13)

- Sélection du tool: le tirage au sort est OBLIGATOIRE avec le tool « random » (operation: pick_random) parmi la liste « Tools restants », sauf s’il ne reste qu’un seul tool (alors sélection directe sans tirage).
- Reload outillé: GET /tools?reload=1 est obligatoire juste avant les tests; par défaut, réponse compacte {reloaded, tool_count, errors}. N’utiliser &list=1 que si nécessaire.
- Pré-tests: 3 à 5 cas nominaux max via POST /execute pour détecter crashs immédiats; ABORT documenté si le serveur n’est pas disponible.
- Invariants outputs: pour les opérations listant des éléments, un paramètre limit (défaut raisonnable), total_count et truncated doivent être présents. Éviter toute sortie verbeuse.
- Taille fichiers: respecter <7KB ou 250 lignes; découper par responsabilités.
- Dead code: supprimer imports/fonctions non utilisés; commit dédié recommandé (refactor: remove dead code (... bytes saved)).
