{
  "version": "1.0",
  "process_version": "1.0.3",
  "metadata": {
    "description": "Production Daily Briefing: Location, Time, Moon Phase with validation",
    "author": "orchestrator-production",
    "tested": true
  },
  "worker_ctx": {
    "timezone": "UTC",
    "sleep_seconds": 3600
  },
  "graph": {
    "nodes": [
      {"name": "START", "type": "start"},
      {
        "name": "get_timestamp",
        "type": "io",
        "handler": "http_tool",
        "inputs": {"tool": "date", "operation": "now", "tz": "UTC"},
        "outputs": {"result": "cycle.data.timestamp"},
        "retry": {"max": 2, "delay_sec": 1},
        "timeout_sec": 15
      },
      {
        "name": "detect_location",
        "type": "io",
        "handler": "http_tool",
        "inputs": {"tool": "device_location", "operation": "get_location"},
        "outputs": {
          "location": "cycle.data.location",
          "coordinates": "cycle.data.coords",
          "timezone": "cycle.data.tz"
        },
        "retry": {"max": 2, "delay_sec": 2},
        "timeout_sec": 20
      },
      {
        "name": "get_moon_phase",
        "type": "io",
        "handler": "http_tool",
        "inputs": {"tool": "astronomy", "operation": "moon_phase"},
        "outputs": {"phase": "cycle.data.moon"},
        "retry": {"max": 2, "delay_sec": 1},
        "timeout_sec": 15
      },
      {
        "name": "validate_data",
        "type": "decision",
        "decision": {"kind": "truthy", "input": "${cycle.data.location}"}
      },
      {
        "name": "mark_success",
        "type": "transform",
        "handler": "sleep",
        "inputs": {"seconds": 0},
        "outputs": {"slept": "cycle.result.ok"}
      },
      {
        "name": "mark_failure",
        "type": "transform",
        "handler": "sleep",
        "inputs": {"seconds": 0},
        "outputs": {"slept": "cycle.result.fail"}
      },
      {"name": "END", "type": "end"}
    ],
    "edges": [
      {"from": "START", "to": "get_timestamp"},
      {"from": "get_timestamp", "to": "detect_location"},
      {"from": "detect_location", "to": "get_moon_phase"},
      {"from": "get_moon_phase", "to": "validate_data"},
      {"from": "validate_data", "to": "mark_success", "when": "true"},
      {"from": "validate_data", "to": "mark_failure", "when": "false"},
      {"from": "mark_success", "to": "END"},
      {"from": "mark_failure", "to": "END"}
    ]
  },
  "scopes": [
    {"name": "data", "reset_on": ["START"], "seed": {}},
    {"name": "result", "reset_on": ["START"], "seed": {}}
  ],
  "graph_mermaid": "graph TD\n  START-->get_timestamp-->detect_location-->get_moon_phase-->validate_data\n  validate_data-->|true|mark_success\n  validate_data-->|false|mark_failure\n  mark_success-->END\n  mark_failure-->END"
}
