
{
  "id": "SCORE",
  "version": "1.0",
  "description": "GPT-4o-mini scoring: analyze all sources and select top 10",
  
  "interface": {
    "entry": "concat_sources",
    "exits": {
      "success": "json_stringify_top10"
    }
  },
  
  "nodes": [
    {
      "name": "concat_sources",
      "type": "transform",
      "handler": "array_concat",
      "inputs": {
        "lists": [
          "${cycle.fresh.news}",
          "${cycle.fresh.reddit}",
          "${cycle.fresh.arxiv}",
          "${cycle.fresh.sonar}"
        ]
      },
      "outputs": {"items": "cycle.scoring.all_items"}
    },
    {
      "name": "dedupe_by_url",
      "type": "transform",
      "handler": "array_ops",
      "inputs": {"op": "unique_by", "items": "${cycle.scoring.all_items}", "key": "url"},
      "outputs": {"items": "cycle.scoring.unique_items"}
    },
    {
      "name": "llm_gpt_score",
      "type": "io",
      "handler": "http_tool",
      "inputs": {
        "tool": "call_llm",
        "model": "${worker.llm_model}",
        "messages": {"$import": "..\/prompts\/gpt_scoring.json"},
        "temperature": "${worker.llm_temperature}",
        "response_format": "json",
        "require_keys": ["content"]
      },
      "outputs": {"content": "cycle.scoring.raw"},
      "timeout_sec": 180,
      "retry": {"max": 2, "delay_sec": 5}
    },
    {
      "name": "normalize_gpt_score",
      "type": "transform",
      "handler": "normalize_llm_output",
      "inputs": {"content": "${cycle.scoring.raw}"},
      "outputs": {"parsed": "cycle.scoring.top10"}
    },
    {
      "name": "json_stringify_top10",
      "type": "transform",
      "handler": "json_stringify",
      "inputs": {"value": "${cycle.scoring.top10}"},
      "outputs": {"json_string": "cycle.scoring.top10_json"}
    }
  ],
  
  "edges": [
    {"from": "concat_sources", "to": "dedupe_by_url"},
    {"from": "dedupe_by_url", "to": "llm_gpt_score"},
    {"from": "llm_gpt_score", "to": "normalize_gpt_score"},
    {"from": "normalize_gpt_score", "to": "json_stringify_top10"}
  ]
}
