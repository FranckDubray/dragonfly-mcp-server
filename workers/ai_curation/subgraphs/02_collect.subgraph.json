{
  "id": "COLLECT",
  "version": "1.0",
  "description": "Multi-source collection (News, Reddit, arXiv, PWC, Sonar) + freshness filter (â‰¤72h)",
  
  "interface": {
    "entry": "fetch_news",
    "exits": {
      "success": "count_pwc"
    }
  },
  
  "nodes": [
    {
      "name": "fetch_news",
      "type": "io",
      "handler": "http_tool",
      "inputs": {
        "tool": "news_aggregator",
        "operation": "search_news",
        "query": "(LLM OR \"large language model\" OR transformer OR \"fine-tuning\") AND (OpenAI OR Anthropic OR DeepMind OR \"Google AI\" OR Meta)",
        "from_date": "${cycle.dates.from}",
        "to_date": "${cycle.dates.now}",
        "providers": ["nyt", "guardian"],
        "limit": 30
      },
      "outputs": {"articles": "cycle.sources.news"},
      "timeout_sec": 30,
      "retry": {"max": 2, "delay_sec": 2}
    },
    {
      "name": "fetch_reddit",
      "type": "io",
      "handler": "http_tool",
      "inputs": {
        "tool": "reddit_intelligence",
        "operation": "multi_search",
        "subreddits": ["MachineLearning", "LocalLLaMA", "OpenAI"],
        "limit_per_sub": 10,
        "time_filter": "week"
      },
      "outputs": {"posts": "cycle.sources.reddit"},
      "timeout_sec": 30,
      "retry": {"max": 2, "delay_sec": 2}
    },
    {
      "name": "fetch_arxiv",
      "type": "io",
      "handler": "http_tool",
      "inputs": {
        "tool": "academic_research_super",
        "operation": "search_papers",
        "query": "large language model OR transformer OR LLM",
        "max_results": 30
      },
      "outputs": {"papers": "cycle.sources.arxiv"},
      "timeout_sec": 30,
      "retry": {"max": 2, "delay_sec": 2}
    },
    {
      "name": "fetch_pwc",
      "type": "io",
      "handler": "http_tool",
      "inputs": {
        "tool": "academic_research_super",
        "operation": "get_trending_papers",
        "category": "nlp",
        "limit": 15
      },
      "outputs": {"papers": "cycle.sources.pwc"},
      "timeout_sec": 30,
      "retry": {"max": 2, "delay_sec": 2}
    },
    {
      "name": "fetch_sonar",
      "type": "io",
      "handler": "http_tool",
      "inputs": {
        "tool": "call_llm",
        "model": "sonar",
        "messages": {"$import": "../prompts/sonar_fetch.json"},
        "temperature": 0.3
      },
      "outputs": {"content": "cycle.sources.sonar_raw"},
      "timeout_sec": 90,
      "retry": {"max": 2, "delay_sec": 5}
    },
    {
      "name": "normalize_sonar",
      "type": "transform",
      "handler": "normalize_llm_output",
      "inputs": {"content": "${cycle.sources.sonar_raw}"},
      "outputs": {"parsed": "cycle.sources.sonar"}
    },
    {
      "name": "filter_news",
      "type": "transform",
      "handler": "filter_by_date",
      "inputs": {
        "items": "${cycle.sources.news}",
        "date_field": "published_at",
        "cutoff_iso": "${cycle.dates.from}"
      },
      "outputs": {"kept": "cycle.fresh.news", "dropped": "cycle.metrics.news_dropped"}
    },
    {
      "name": "filter_reddit",
      "type": "transform",
      "handler": "filter_by_date",
      "inputs": {
        "items": "${cycle.sources.reddit}",
        "date_field": "created_utc",
        "cutoff_iso": "${cycle.dates.from}"
      },
      "outputs": {"kept": "cycle.fresh.reddit", "dropped": "cycle.metrics.reddit_dropped"}
    },
    {
      "name": "filter_arxiv",
      "type": "transform",
      "handler": "filter_by_date",
      "inputs": {
        "items": "${cycle.sources.arxiv}",
        "date_field": "published",
        "cutoff_iso": "${cycle.dates.from}"
      },
      "outputs": {"kept": "cycle.fresh.arxiv", "dropped": "cycle.metrics.arxiv_dropped"}
    },
    {
      "name": "filter_sonar",
      "type": "transform",
      "handler": "filter_by_date",
      "inputs": {
        "items": "${cycle.sources.sonar}",
        "date_field": "published_at",
        "cutoff_iso": "${cycle.dates.from}"
      },
      "outputs": {"kept": "cycle.fresh.sonar", "dropped": "cycle.metrics.sonar_dropped"}
    },
    {
      "name": "count_pwc",
      "type": "transform",
      "handler": "set_value",
      "inputs": {"value": "${cycle.sources.pwc}"},
      "outputs": {"result": "cycle.fresh.pwc"}
    }
  ],
  
  "edges": [
    {"from": "fetch_news", "to": "fetch_reddit"},
    {"from": "fetch_reddit", "to": "fetch_arxiv"},
    {"from": "fetch_arxiv", "to": "fetch_pwc"},
    {"from": "fetch_pwc", "to": "fetch_sonar"},
    {"from": "fetch_sonar", "to": "normalize_sonar"},
    {"from": "normalize_sonar", "to": "filter_news"},
    {"from": "filter_news", "to": "filter_reddit"},
    {"from": "filter_reddit", "to": "filter_arxiv"},
    {"from": "filter_arxiv", "to": "filter_sonar"},
    {"from": "filter_sonar", "to": "count_pwc"}
  ]
}
