{
  "id": "WAND_SELECT",
  "version": "1.1",
  "description": "Vanilla selection: raycast 1..6 blocs devant le joueur propriétaire pour tagger une pièce (@e[tag=chess_piece]) comme chess_selected. Exits: idle si rien, selected sinon.",
  "interface": {"entry": "CLEAR_PREV_SEL", "exits": {"idle": "EXIT_IDLE", "selected": "EXIT_SELECTED"}},
  "nodes": [
    {"name": "CLEAR_PREV_SEL", "type": "io", "handler": "http_tool",
     "inputs": {"tool": "minecraft_control", "operation": "execute_command",
                 "command": "tag @e[tag=chess_selected] remove chess_selected"}},

    {"name": "SELECT_RAYCAST", "type": "io", "handler": "http_tool",
     "inputs": {"tool": "minecraft_control", "operation": "batch_commands", "delay_ms": 0,
                 "commands": [
                   "execute as @a[tag=chess_owner] at @s rotated as @s positioned ^ ^ ^1 if entity @e[tag=chess_piece,distance=..0.7] run tag @e[tag=chess_piece,limit=1,sort=nearest,distance=..1] add chess_selected",
                   "execute as @a[tag=chess_owner] at @s rotated as @s positioned ^ ^ ^2 if entity @e[tag=chess_piece,distance=..0.7] run tag @e[tag=chess_piece,limit=1,sort=nearest,distance=..1] add chess_selected",
                   "execute as @a[tag=chess_owner] at @s rotated as @s positioned ^ ^ ^3 if entity @e[tag=chess_piece,distance=..0.7] run tag @e[tag=chess_piece,limit=1,sort=nearest,distance=..1] add chess_selected",
                   "execute as @a[tag=chess_owner] at @s rotated as @s positioned ^ ^ ^4 if entity @e[tag=chess_piece,distance=..0.7] run tag @e[tag=chess_piece,limit=1,sort=nearest,distance=..1] add chess_selected",
                   "execute as @a[tag=chess_owner] at @s rotated as @s positioned ^ ^ ^5 if entity @e[tag=chess_piece,distance=..0.7] run tag @e[tag=chess_piece,limit=1,sort=nearest,distance=..1] add chess_selected",
                   "execute as @a[tag=chess_owner] at @s rotated as @s positioned ^ ^ ^6 if entity @e[tag=chess_piece,distance=..0.7] run tag @e[tag=chess_piece,limit=1,sort=nearest,distance=..1] add chess_selected"
                 ]}},

    {"name": "LIST_SELECTED", "type": "io", "handler": "http_tool",
     "inputs": {"tool": "minecraft_control", "operation": "list_entities", "selector": "@e[tag=chess_selected]",
                 "fields": ["uuid", "pos", "tags"], "limit": 1},
     "outputs": {"result": "cycle.wand.sel"}},

    {"name": "HAS_SELECTION", "type": "decision", "decision": {"kind": "truthy", "input": "${cycle.wand.sel}"}},

    {"name": "WH_MSG_SELECTED", "type": "io", "handler": "http_tool",
     "inputs": {"tool": "minecraft_control", "operation": "execute_command",
                 "command": "title @a[tag=chess_owner] actionbar {\"text\":\"Pièce sélectionnée\",\"color\":\"aqua\"}"}},

    {"name": "EXIT_IDLE", "type": "transform", "handler": "set_value", "inputs": {"value": true}},
    {"name": "EXIT_SELECTED", "type": "transform", "handler": "set_value", "inputs": {"value": true}}
  ],
  "edges": [
    {"from": "CLEAR_PREV_SEL", "to": "SELECT_RAYCAST"},
    {"from": "SELECT_RAYCAST", "to": "LIST_SELECTED"},
    {"from": "LIST_SELECTED", "to": "HAS_SELECTION"},
    {"from": "HAS_SELECTION", "to": "EXIT_IDLE", "when": "false"},
    {"from": "HAS_SELECTION", "to": "WH_MSG_SELECTED", "when": "true"},
    {"from": "WH_MSG_SELECTED", "to": "EXIT_SELECTED"}
  ]
}
